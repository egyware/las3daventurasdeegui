<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Las 3D Aventuras de Egui - Lista de proveedores</title>
    <link rel="stylesheet" href="https://bootswatch.com/4/lux/bootstrap.min.css">    
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/7.15.5/firebase-app.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/7.15.5/firebase-analytics.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/7.15.5/firebase-messaging.js"></script>
    <script defer src="./init-firebase.js"></script>
</head>
<body>    
    <div class="container" p-4>        
        <h2>Tiendas</h2>
        <div class="row"><a href="agregarProveedor.html">Agregar Tienda</a></div>        
        <div class="row" id="tiendas">Cargando lista....</div>        
        <div class="row">
            <p>Sigueme en instagram <a href="https://www.instagram.com/las3daventurasdeegui/">@las3daventurasdeegui</a></p>
        </div>        
    </div>
    <script defer> 
            function obtenerToken(){
                messaging.getToken().then((currentToken) => {
                    if (currentToken) {
                        console.log(currentToken);                    
                    } else {
                        // Show permission request.
                        console.log('No Instance ID token available. Request permission to generate one.');                
                    }
                }).catch((err) => {
                    console.log('An error occurred while retrieving token. ', err);                   
                });
            }                  
            function notificaciones()
            {
                Notification.requestPermission().then((permission) => {
                    if (permission === 'granted') {
                        console.log('Notification permission granted.');
                            obtenerToken();                        
                    } else {
                        console.log('Unable to get permission to notify.');
                    }                
                });
            }
            // messaging.onMessage((payload) => {
            //     console.log('Message received. ', payload);                    
            // });
            
            $.ajax({
                url: "/api/proveedores",
            }).done(function($data) {
                var html = [];
                $data.forEach(function($item){
                    const newItem = 
                        `<div class="col-12 col-md-4 p-2">
                            <div class="card" style="height:285px;max-height:285px">                            
                                <div class="card-header">
                                <h5 class="card-title text-truncate">
                                    ${ $item.favicon != null ? `<img class="img-fluid" style="max-height:1.75rem" src="${$item.favicon}" />`: `` }
                                    <a href="${$item.website}">${$item.empresa}</a>
                                </h5>
                                </div>
                                <div class="card-body text-left" style="height:180px;overflow-y:auto">                                                                              
                                    <p>${$item.descripcion}</p>                                
                                </div>                            
                                ${$item.scrapedProductos > 0 ? `<div class="card-footer"><a href="/stock/${$item.id}">Ver Stock</a></div>`: ``}
                            </div>
                        </div>`;                        
                    html.push(newItem);                        
                })
                $('#tiendas').html(html.join(""));
            });        
    </script>    
</body>
</html>
